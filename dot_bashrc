source ~/bash_completion.d/git
source ~/bash_completion.d/kubectl

# Git
alias ga='git add .'
alias gbdel-feature='gbdel "feature/"'
alias gbdel-bugs='gbdel "bug/"'
alias gc='git checkout'
alias gs='git status'
alias gcb='git checkout -b'
alias gcm='git commit -m'
alias gpl='git pull'
alias gps='git push'
alias gpso='git branch --show-current | xargs git push --set-upstream origin'

gbdel() {
  local pattern="${1:?Usage: gbdel <pattern> [--dry-run]}"
  local dry_run=false

  if [[ "$2" == "--dry-run" || "$2" == "-n" ]]; then
    dry_run=true
  fi

  local branches
  branches=$(git branch --list "*${pattern}*" | grep -v '^\*' | sed 's/^[[:space:]]*//')

  if [[ -z "$branches" ]]; then
    echo "No branches matching '*${pattern}*'"
    return 0
  fi

  echo "Branches matching '*${pattern}*':"
  echo "$branches" | sed 's/^/  /'
  echo ""

  if $dry_run; then
    echo "(dry run â€” nothing deleted)"
    return 0
  fi

  read -p "Delete these branches? [y/N] " confirm
  if [[ "$confirm" =~ ^[Yy]$ ]]; then
    echo "$branches" | xargs git branch -D
  else
    echo "Aborted."
  fi
}

gcd() {
  git checkout "$(git symbolic-ref refs/remotes/origin/HEAD 2>/dev/null | sed 's@^refs/remotes/origin/@@')" 2>/dev/null \
    || git checkout main 2>/dev/null \
    || git checkout master
}

gcdpl() {
  gcd && gpl
}

# Docker Compose
alias dcu='docker compose up -d'
alias dcs='docker compose stop'

# Kubectl
alias k='kubectl'
alias kg='kubectl get'
alias kgdep='kubectl get deployment'
alias kd='kubectl describe'

# Disposable RabbitMQ
alias rmq='docker run --rm -it -d --name rabbitmq --hostname rabbitmq -p 15672:15672 -p 5672:5672 rabbitmq:3-management'

# Winget
alias wu='winget upgrade'
alias wua='winget upgrade --all'

# WAU Management
alias wau-log='tail -50 "/c/Program Files/Winget-AutoUpdate/logs/updates.log"'
alias wau-excluded='cat "/c/Program Files/Winget-AutoUpdate/excluded_apps.txt"'
alias wau-config='reg query "HKLM\SOFTWARE\Romanitho\Winget-AutoUpdate"'
alias wau-run='powershell.exe -Command "Start-ScheduledTask -TaskName Winget-AutoUpdate"'